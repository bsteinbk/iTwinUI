// Copyright (c) Bentley Systems, Incorporated. All rights reserved.
// See LICENSE.md in the project root for license terms and full copyright notice.
@import '../style/index';
@import '../icon/index';
@import './variables';

@mixin iui-table {
  @include iui-reset;
  @include iui-font-family;
  display: flex;
  flex-direction: column;
  padding: 0;

  * {
    box-sizing: border-box;
  }

  .iui-header,
  .iui-row {
    display: flex;
    flex-grow: 1;
    width: 100%;
  }

  .iui-header {
    user-select: none;
    @include themed {
      background-color: t(iui-color-background-3);
    }

    > .iui-cell:not(.iui-slot) > .iui-borderless {
      margin-left: $iui-xs;

      &:not(.iui-active) {
        visibility: hidden;
      }
    }

    .iui-cell:not(.iui-slot) {
      @include iui-focus;
      cursor: pointer;

      &:hover,
      &:focus,
      &:focus-within {
        @include themed {
          background-color: t(iui-color-background-4);
        }

        .iui-sort,
        .iui-borderless {
          visibility: visible;
        }
      }
    }

    .iui-sort {
      visibility: hidden;
      margin-left: auto;
      width: $iui-icons-default;
      height: $iui-icons-default;
      @include themed {
        fill: t(iui-icons-color-actionable);
      }
    }

    .iui-active-sort {
      @include themed {
        background-color: t(iui-color-background-4);
      }

      .iui-sort {
        visibility: visible;
        
        &,
        & > * {
          @include themed {
            fill: t(iui-icons-color-actionable);
          }
        }
      }
    }
  }

  .iui-body {
    width: 100%;
    @include themed {
      background-color: t(iui-color-background-1);
    }
    
    .iui-row {
      margin-top: -1px;
      border: solid 1px transparent;

      &:not(:last-child) {
        @include themed {
          border-bottom: solid 1px t(iui-color-background-4);
        }
      }
  
      > .iui-slot > .iui-button {
        visibility: hidden;
      }
  
      &:hover:not(.iui-disabled) {
        &:not(.iui-selected) {
          @include themed {
            background-color: rgba(
              t(iui-color-foreground-primary-rgb),
              t(iui-opacity-6)
            ) !important;
          }
        }
  
        > .iui-slot > .iui-button {
          visibility: visible;
        }
      }
  
      > .iui-cell {
        position: relative;
        align-items: center;
        display: flex;
        flex-grow: 1;
        min-width: 145px;
        min-height: $iui-baseline * 5;
        padding: 0 $iui-m;
        overflow: hidden;
        list-style: none;
        flex-basis: 145px;
  
        > svg {
          width: $iui-icons-default;
          height: $iui-icons-default;
          margin-right: $iui-sm;
        }
  
        > .iui-status,
        > .iui-progress-indicator-radial {
          float: right;
          margin-left: auto;
        }
  
        > .iui-status {
          margin-right: $iui-xs;
        }
  
        > .iui-user-icon {
          margin-right: $iui-s;
        }
  
        &.iui-slot {
          width: $iui-l * 2;
          padding: 0;
          flex-grow: 0;
          min-width: 0;
          display: flex;
          justify-content: center;
          align-items: center;
          flex-basis: $iui-l * 2;
  
          > .iui-icon {
            @include themed {
              fill: t(iui-icons-color-actionable);
              color: t(iui-icons-color-actionable);
            }
            width: $iui-icons-default;
            height: $iui-icons-default;
            margin: 0;
          }
        }
  
        &.iui-tables-head {
          @include themed {
            background-color: t(iui-color-background-3);
          }
          user-select: none;
  
          .iui-icon {
            @include themed {
              fill: t(iui-icons-color-actionable);
            }
  
            &:hover {
              @include themed {
                fill: t(iui-icons-color-actionable-hover);
              }
            }
          }
  
          > .iui-sort {
            flex-grow: 1;
            justify-content: flex-end !important;
  
            > .iui-icon-wrapper {
              cursor: pointer;
  
              > .iui-icon {
                width: $iui-icons-default;
                height: $iui-icons-default;
              }
            }
          }
  
          > .iui-filter,
          > .iui-sort,
          > .iui-sort > .iui-icon-wrapper {
            height: $iui-icons-default;
            width: $iui-icons-default;
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
          }
  
          > .iui-filter.iui-selected {
            visibility: visible;
    
            > .iui-icon {
              @include themed {
                fill: t(iui-icons-color-primary);
              }
            }
          }
  
          &:hover {
            @include themed {
              background-color: t(iui-color-background-4);
            }
  
            > .iui-filter,
            > .iui-sort,
            > .iui-sort > .iui-icon-wrapper {
              visibility: visible;
            }
          }
        }
      }
  
      // #region Selection
      &:not(.iui-selected) + .iui-selected {
        padding-bottom: 2px;
        border-bottom: none;
      }

      &.iui-selected {
        padding: 0;
        border-bottom: 0 none;

        border: solid 1px t(iui-color-foreground-primary);
        background: rgba(t(iui-color-foreground-primary-rgb), t(iui-opacity-5));

        &:hover {
          background: rgba(
            t(iui-color-foreground-primary-rgb),
            t(iui-opacity-5)
          );
        }

        & + .iui-selected {
          border-bottom: 0;
          padding-bottom: 2px;
          border-top: 1px solid
            rgba(t(iui-color-foreground-primary-rgb), t(iui-opacity-4));
          padding-top: 0;
        }

        &:last-child {
          padding-bottom: 1px;
          border-bottom: 1px solid t(iui-color-foreground-primary);
        }

        &:first-child {
          border-bottom: 0;
          padding-bottom: 2px;
        }

        // Last selected item in a row.
        & + :not(.iui-selected) {
          padding-top: 0;
          margin-left: 0;
          margin-right: 0;
          border-top: 1px solid t(iui-color-foreground-primary);
        }
      }

      &:last-child {
        padding-bottom: 2px;
        border-bottom: 0;
      }
      // #endregion Selection
  
      &.iui-new {
        font-weight: $iui-font-weight-semibold;

        /* UNSURE ABOUT THIS
        .iui-positive {
          @include themed {
            fill: t(iui-color-foreground-positive);
          }
        }
        */
  
        
        > .iui-main-column::before {
          @include themed {
            color: t(iui-color-foreground-positive);
          }
          content: 'â€¢';
          position: absolute;
          left: 0;
          font-size: $iui-font-size-title;
        }   
      }
  
      &.iui-disabled {
        font-style: italic;
        cursor: not-allowed;
        @include themed {
          color: t(iui-text-color-muted);
        }
  
        &:hover > .iui-slot > .iui-button {
          visibility: hidden;
        }
  
        img,
        svg:not(.iui-radial),
        .iui-user-icon {
          filter: $iui-icons-color-multicolor-disabled;
        }
      }

      &.iui-positive {
        @include themed {
          box-shadow: inset $iui-xxs 0 0 0 t(iui-icons-color-positive);
        }

        .iui-status {
          @include themed {
            fill: t(iui-icons-color-positive);
          }
        }

        *::selection {
          @include themed {
            background-color: rgba(
              t(iui-color-foreground-positive-rgb),
              t(iui-opacity-4)
            );
          }
        }
      }
      
      &.iui-warning {
        @include themed {
          box-shadow: inset $iui-xxs 0 0 0 t(iui-icons-color-warning);
        }

        .iui-status {
          @include themed {
            fill: t(iui-icons-color-warning);
          }
        }

        *::selection {
          @include themed {
            background-color: rgba(
              t(iui-color-foreground-warning-rgb),
              t(iui-opacity-4)
            );
          }
        }
      }

      &.iui-negative {
        @include themed {
          box-shadow: inset $iui-xxs 0 0 0 t(iui-icons-color-negative);
        }

        .iui-status {
          @include themed {
            fill: t(iui-icons-color-negative);
          }
        }

        *::selection {
          @include themed {
            background-color: rgba(
              t(iui-color-foreground-negative-rgb),
              t(iui-opacity-4)
            );
          }
        }
      }
    }

    &.iui-message {
      text-align: center;
      height: 100%;
      padding: $iui-xl;
      @include themed {
        color: t(iui-text-color-muted);
        background-color: t(iui-color-background-2);
      }
    }
  }

  .iui-cell {
    align-items: center;
    display: flex;
    flex-grow: 1;
    min-width: 145px;
    min-height: $iui-baseline * 5;
    padding: 0 $iui-m;
    overflow: hidden;
    list-style: none;
    flex-basis: 145px;

    > svg {
      width: $iui-icons-default;
      height: $iui-icons-default;
    }

    > .iui-status,
    > .iui-progress-indicator-radial {
      float: right;
      margin-left: auto;
    }

    > .iui-status {
      margin-right: $iui-xs;
    }

    > .iui-user-icon {
      margin-right: $iui-s;
    }

    &.iui-slot {
      width: $iui-l * 2;
      padding: 0;
      flex-grow: 0;
      min-width: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-basis: $iui-l * 2;

      > .iui-icon {
        @include themed {
          fill: t(iui-icons-color-actionable);
          color: t(iui-icons-color-actionable);
        }
        width: $iui-icons-default;
        height: $iui-icons-default;
        margin: 0;
      }
    }
    
    &.iui-right-align {
      justify-content: flex-end;
    }

    &.iui-positive {
      @include themed {
        background-color: rgba(
          t(iui-color-foreground-positive-rgb),
          t(iui-opacity-6)
        );
      }

      &::selection {
        @include themed {
          background-color: rgba(
            t(iui-color-foreground-positive-rgb),
            t(iui-opacity-4)
          );
        }
      }
    }
    
    &.iui-warning {
      @include themed {
        background-color: rgba(
          t(iui-color-foreground-warning-rgb),
          t(iui-opacity-6)
        );

        &::selection {
          @include themed {
            background-color: rgba(
              t(iui-color-foreground-warning-rgb),
              t(iui-opacity-4)
            );
          }
        }
      }
    }

    &.iui-negative {
      @include themed {
        background-color: rgba(
          t(iui-color-foreground-negative-rgb),
          t(iui-opacity-6)
        );
      }

      &::selection {
        @include themed {
          background-color: rgba(
            t(iui-color-foreground-negative-rgb),
            t(iui-opacity-4)
          );
        }
      }
    }
  }

  &.iui-zebra-striping > .iui-body > .iui-row:nth-child(even):not(.iui-selected) {
    @include themed {
      background: rgba(t(iui-color-foreground-body-rgb), 0.02);
    }
  }

  &.iui-fixed > .iui-body {
    max-height: 300px;
    overflow-x: hidden;
    overflow-y: scroll;
    overflow: overlay;
  }
}
